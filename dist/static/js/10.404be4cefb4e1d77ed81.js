webpackJsonp([10,12],{302:function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}var r=i(339),o=a(r);e.exports=o.default},339:function(e,t,i){"use strict";var a=i(22);e.exports={name:"edit-article",data:function(){return{url:a.gbs.host+"/image",postData:{type:"14"},dialogImageUrl:"",dialogVisible:!1,formLoading:!1,fileList:[],headers:{Authorization:this.$store.state.user.userinfo.token_type+" "+this.$store.state.user.userinfo.token},article_data:{title:"",cate:"",tags:"",cover:0,content:""},temp:{content:""},rules:{title:[{required:!0,message:"文章标题不能为空！",trigger:"blur"}],tags:[{required:!0,message:"请至少添加一个文章标签！",trigger:"change"}],content:[{required:!0,message:"文章不能为空！",trigger:"blur"}],cover:[{min:1,required:!0,message:"封面不能为空！",trigger:"blur"}]},wangEditor:{bar:["source","|","bold","underline","italic","strikethrough","eraser","forecolor","bgcolor","|","quote","fontfamily","fontsize","head","unorderlist","orderlist","alignleft","aligncenter","alignright","|","link","unlink","table","emotion","|","img","video","insertcode","|","undo","redo","fullscreen"]}}},methods:{onSubmit:function(e){var t=this;if(0==this.article_data.cover)return this.$message("请选择封面图片！"),!1;var i=this.$refs[e];i.validate(function(e){if(e){if(!t.temp.content){if((t.article_data.content.indexOf("<iframe")==-1||t.article_data.content.indexOf("</iframe>")==-1)&&t.article_data.content.indexOf("<img")==-1)return void t.$message.error("文章内容不能为空！");return}t.$$api_article_articles(t.article_data,function(e){t.$router.push("/admin/article/list")})}})},setContent:function(e,t){this.article_data.content=e,this.temp.content=t},reset_article:function(e){this.$refs[e].resetFields()},handleRemove:function(e,t){console.log(e,t),this.article_data.cover=0},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},uploadSuccess:function(e,t,i){this.article_data.cover=e.data.id},uploadBefore:function(e){if(0!=this.article_data.cover)return this.$message("封面只能传一张！"),!1}},mounted:function(){var e=this,t=this,i=new wangEditor("article");if(this.formLoading=!0,console.log(i.config),i.config.uploadImgFileName="images",i.config.uploadImgUrl=this.url,i.config.uploadParams={type:14},console.log(this.headers),i.config.uploadHeaders=this.headers,i.config.uploadImgFns.onload=function(t){if(200===t.status){var r=i.uploadImgOriginalName||"";i.command(null,"insertHtml",'<img src="'+a.gbs.image_host+"/"+t.data.dirname+"/"+t.data.basename+'" alt="'+r+'" style="max-width:100%;"/>')}else 404===t.status?e.$message.error("上传错误信息：token无效！"):e.$message.error("上传错误信息："+t.msg)},i.config.uploadImgFns.onerror=function(t){e.$message.error("上传错误信息：网络错误！")},i.config.menus=this.wangEditor.bar,i.onchange=function(){var e=this.$txt.text().replace(/(^\s*)|(\s*$)/g,""),i=this.$txt.html();t.setContent(i,e)},i.create(),$("#article").height(540),this.$route.query.id){var r={httpResourceUrl:"/"+this.$route.query.id,id:this.$route.query.id};this.$$api_article_findArticle(r,function(t){e.fileList=[{name:t.cover.url,url:a.gbs.image_host+"/"+t.cover.url}],e.article_data=t,e.article_data.cover=t.cover.id,e.temp.content=e.article_data.content,$("#article").html(e.article_data.content),e.formLoading=!1})}else this.formLoading=!1}}},487:function(e,t,i){t=e.exports=i(10)(),t.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",file:"Edit.vue",sourceRoot:"webpack://"}])},777:function(e,t,i){var a=i(487);"string"==typeof a&&(a=[[e.id,a,""]]);i(11)(a,{});a.locals&&(e.exports=a.locals)},795:function(e,t,i){i(777);var a=i(6)(i(302),i(831),"data-v-d4ff9118",null);e.exports=a.exports},831:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"form"},[i("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.formLoading,expression:"formLoading"}],ref:"refArticle",staticStyle:{margin:"20px",width:"90%","min-width":"600px"},attrs:{"label-width":"100px",model:e.article_data,rules:e.rules}},[i("el-form-item",{staticStyle:{width:"600px"},attrs:{label:"文章标题",prop:"title"}},[i("el-input",{model:{value:e.article_data.title,callback:function(t){e.article_data.title=t},expression:"article_data.title"}})],1),e._v(" "),i("el-form-item",{staticStyle:{width:"986px"},attrs:{label:"文章内容",prop:"content"}},[i("div",{staticStyle:{height:"640px"},attrs:{id:"article"}})]),e._v(" "),i("el-form-item",{attrs:{label:"文章标签",prop:"tags"}},[i("el-input",{model:{value:e.article_data.tags,callback:function(t){e.article_data.tags=t},expression:"article_data.tags"}}),e._v(" "),i("span",[e._v("多个用英文逗号隔开")])],1),e._v(" "),i("el-form-item",{attrs:{label:"封面"}},[i("div",[i("el-upload",{attrs:{name:"images",action:e.url,data:e.postData,headers:e.headers,"list-type":"picture-card","file-list":e.fileList,"on-preview":e.handlePictureCardPreview,"on-remove":e.handleRemove,"on-success":e.uploadSuccess,"before-upload":e.uploadBefore}},[i("i",{staticClass:"el-icon-plus"})])],1)]),e._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.onSubmit("refArticle")}}},[e._v("立即"+e._s(e.article_data.id?"修改":"添加")+"\n            ")]),e._v(" "),i("el-button",{on:{click:function(t){e.reset_article("article_data")}}},[e._v("重置")])],1)],1),e._v(" "),i("el-dialog",{attrs:{size:"tiny"},model:{value:e.dialogVisible,callback:function(t){e.dialogVisible=t},expression:"dialogVisible"}},[i("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1)},staticRenderFns:[]}}});
//# sourceMappingURL=10.404be4cefb4e1d77ed81.js.map